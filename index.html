# Build a "file app" bundle with a dark, glassy panel like the screenshot.
# It includes both: (1) a tap-to-earn glasses game and (2) a mint/pay panel.
import os, zipfile, shutil, textwrap

root = "/mnt/data/vision-glasses-fileapp"
if os.path.exists(root):
    shutil.rmtree(root)
os.makedirs(root, exist_ok=True)

index_html = """<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vision Glasses — Mini App</title>
  <link rel="icon" href="data:," />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="backdrop"></div>
  <main class="wrap">
    <section class="card">
      <header class="card__header">
        <div class="brand">
          <h1>Vision Glasses NFT's</h1>
          <p class="muted">Private mint • Vision Glasses • Digital Ownership Badge</p>
        </div>
        <nav class="tabs">
          <button class="tab active" data-tab="mint">Mint</button>
          <button class="tab" data-tab="tap">Tap Game</button>
        </nav>
      </header>

      <!-- Mint panel -->
      <div class="panel active" id="panel-mint">
        <div class="mint-grid">
          <div class="media">
            <img src="glasses.png" alt="Vision Glasses" class="nft" />
          </div>
          <div class="details">
            <div class="field">
              <label>Choose network</label>
              <div class="choices">
                <button class="chip chip--active">ETH</button>
                <button class="chip" disabled title="Coming soon">BTC</button>
                <button class="chip" disabled title="Coming soon">BNB</button>
              </div>
            </div>

            <div class="field">
              <label>Pay with your wallet</label>
              <div class="wallet-row">
                <button id="connect" class="btn subtle">Connect Wallet</button>
                <span id="short">Not connected</span>
              </div>
              <div class="hint">Price: <strong>$50</strong> (~0.03 ETH). Funds go to:</div>
              <div class="addr" id="address">0xc15a5316B75ab200E0c24688f85ef9612D70bBd8</div>
              <div id="status" class="status muted">Status: idle</div>
              <div class="actions">
                <button id="pay" class="btn primary">Mint / Pay</button>
                <a class="btn ghost" href="https://etherscan.io/address/0xc15a5316B75ab200E0c24688f85ef9612D70bBd8" target="_blank">View on Etherscan</a>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Tap-to-earn panel -->
      <div class="panel" id="panel-tap">
        <div class="tap-wrap">
          <p class="muted">Tap the glasses to earn points. Your best score is saved on this device.</p>
          <div class="tap-stage">
            <img id="tap-glasses" src="glasses.png" alt="Tap Glasses" />
            <div id="tap-pop" class="pop hidden">+1</div>
          </div>
          <div class="scores">
            <div>Score: <span id="score">0</span></div>
            <div>Best: <span id="best">0</span></div>
          </div>
          <div class="actions">
            <button id="reset" class="btn ghost">Reset Score</button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Minimal scripts (no framework needed) -->
  <script src="script.js"></script>
</body>
</html>
"""

style_css = """/* --- Base --- */
*{box-sizing:border-box}
:root{
  --bg:#030711;
  --panel:#0b1222;
  --panel-2:#0d1a33;
  --text:#e6eefc;
  --muted:#9fb4d6;
  --accent:#5de1e6;
  --accent-2:#00bcd4;
  --ring:rgba(93,225,230,.35)
}
html,body{height:100%}
body{margin:0;background:radial-gradient(1200px 600px at 70% -10%, #0b1a3d 0%, transparent 60%),linear-gradient(180deg,#050914 0%,#030711 100%);color:var(--text);font-family:Inter,system-ui,Arial,sans-serif;display:grid;place-items:center}

/* --- Backdrop glow --- */
.backdrop{position:fixed;inset:0;pointer-events:none;background:radial-gradient(800px 400px at 20% 0%,rgba(0,188,212,.12),transparent 60%),radial-gradient(800px 400px at 90% 10%,rgba(93,225,230,.1),transparent 60%)}

/* --- Layout --- */
.wrap{width:100%;padding:24px}
.card{max-width:860px;margin:0 auto;background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.06);border-radius:18px;box-shadow:0 30px 80px rgba(0,0,0,.6),inset 0 1px 0 rgba(255,255,255,.04)}

/* --- Header --- */
.card__header{display:flex;align-items:flex-end;justify-content:space-between;padding:20px 22px;border-bottom:1px solid rgba(255,255,255,.06)}
.brand h1{margin:0;font-size:18px;letter-spacing:.2px;color:var(--text)}
.muted{color:var(--muted);font-size:13px}
.tabs{display:flex;gap:8px}
.tab{appearance:none;border:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.02);color:var(--text);padding:8px 12px;border-radius:10px;cursor:pointer}
.tab.active{border-color:var(--accent);box-shadow:0 0 0 3px var(--ring)}

/* --- Panels --- */
.panel{display:none;padding:22px}
.panel.active{display:block}

/* --- Mint grid --- */
.mint-grid{display:grid;grid-template-columns:320px 1fr;gap:18px}
.media{display:flex;justify-content:center;align-items:center;background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));border:1px dashed rgba(255,255,255,.08);border-radius:14px;padding:12px}
.nft{max-width:100%;border-radius:10px;box-shadow:0 20px 60px rgba(2,10,20,.6)}
.details{display:flex;flex-direction:column;gap:16px}
.field label{display:block;margin-bottom:6px;color:var(--muted);font-size:12px}
.choices{display:flex;gap:8px}
.chip{padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,.1);background:rgba(255,255,255,.03);color:var(--text);cursor:pointer}
.chip--active{border-color:var(--accent);box-shadow:0 0 0 3px var(--ring)}
.wallet-row{display:flex;gap:10px;align-items:center}
.addr{margin-top:6px;font-family:ui-monospace,SFMono-Regular,Menlo,monospace;background:var(--panel);border:1px solid rgba(255,255,255,.07);padding:10px;border-radius:10px;word-break:break-all}
.status{margin-top:6px}
.actions{display:flex;gap:10px;margin-top:10px}

/* --- Buttons --- */
.btn{appearance:none;border:0;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer}
.btn.primary{background:linear-gradient(90deg,var(--accent-2),var(--accent));color:#001219}
.btn.subtle{background:#18243e;color:var(--text);border:1px solid rgba(255,255,255,.08)}
.btn.ghost{background:transparent;border:1px solid rgba(255,255,255,.12);color:var(--text)}

/* --- Tap game --- */
.tap-wrap{display:flex;flex-direction:column;align-items:center;gap:14px}
.tap-stage{position:relative;display:grid;place-items:center;background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));border:1px dashed rgba(255,255,255,.08);border-radius:14px;padding:18px;min-height:320px;width:100%;max-width:420px}
.tap-stage img{width:260px;transition:transform .1s ease}
.tap-stage img:active{transform:scale(1.08)}
.pop{position:absolute;top:50%;transform:translate(-50%,-50%);left:50%;font-weight:800;font-size:22px;color:var(--accent);text-shadow:0 2px 12px rgba(93,225,230,.6);opacity:0;transition:opacity .15s, transform .15s}
.pop.show{opacity:1;transform:translate(-50%,-64%)}
.hidden{display:none}
.scores{display:flex;gap:18px;font-weight:700}

/* --- Responsive --- */
@media (max-width: 860px){
  .mint-grid{grid-template-columns:1fr}
}"""

script_js = """// Tabs
const tabs = document.querySelectorAll('.tab');
const panels = { mint: document.getElementById('panel-mint'), tap: document.getElementById('panel-tap') };
tabs.forEach(btn => btn.addEventListener('click', () => {
  tabs.forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  Object.values(panels).forEach(p => p.classList.remove('active'));
  panels[btn.dataset.tab].classList.add('active');
}));

// Wallet (optional) – This keeps it 'file-app' friendly; full wallet features need hosting/https.
const connectBtn = document.getElementById('connect');
const payBtn = document.getElementById('pay');
const shortEl = document.getElementById('short');
const statusEl = document.getElementById('status');

let provider = null, signer = null, addr = null;
function shorten(a){ return a ? a.slice(0,6)+'…'+a.slice(-4) : '—'; }

connectBtn?.addEventListener('click', async () => {
  statusEl.textContent = 'Status: connecting...';
  if (!window.ethereum) {
    statusEl.textContent = 'MetaMask not found. This works best when hosted (https).';
    return;
  }
  try {
    provider = new ethers.providers.Web3Provider(window.ethereum);
    await provider.send('eth_requestAccounts', []);
    signer = provider.getSigner();
    addr = await signer.getAddress();
    shortEl.textContent = shorten(addr);
    statusEl.textContent = 'Status: connected';
  } catch (e) {
    statusEl.textContent = 'Connection cancelled.';
  }
});

payBtn?.addEventListener('click', async () => {
  if (!signer) {
    statusEl.textContent = 'Connect wallet first.';
    return;
  }
  try {
    const value = ethers.utils.parseEther('0.03'); // ~ $50
    const tx = await signer.sendTransaction({
      to: '0xc15a5316B75ab200E0c24688f85ef9612D70bBd8',
      value
    });
    statusEl.innerHTML = 'Tx sent: <a target="_blank" href="https://etherscan.io/tx/'+tx.hash+'">'+tx.hash+'</a>';
    await tx.wait();
    statusEl.innerHTML = '✅ Confirmed: <a target="_blank" href="https://etherscan.io/tx/'+tx.hash+'">'+tx.hash+'</a>';
  } catch (e) {
    statusEl.textContent = 'Error: '+ (e && e.message ? e.message : 'transaction failed');
  }
});

// Tap game
const img = document.getElementById('tap-glasses');
const pop = document.getElementById('tap-pop');
const scoreEl = document.getElementById('score');
const bestEl = document.getElementById('best');
const resetBtn = document.getElementById('reset');

let score = Number(localStorage.getItem('vg_score') || 0);
let best = Number(localStorage.getItem('vg_best') || 0);
scoreEl.textContent = score;
bestEl.textContent = best;

img?.addEventListener('click', () => {
  score++;
  scoreEl.textContent = score;
  if (score > best){ best = score; bestEl.textContent = best; localStorage.setItem('vg_best', best); }
  localStorage.setItem('vg_score', score);
  pop.classList.remove('hidden');
  pop.classList.add('show');
  clearTimeout(window.__popTimer);
  window.__popTimer = setTimeout(() => pop.classList.remove('show'), 160);
});

resetBtn?.addEventListener('click', () => {
  score = 0;
  scoreEl.textContent = score;
  localStorage.setItem('vg_score', score);
});"""

# Write files
with open(os.path.join(root, "index.html"), "w", encoding="utf-8") as f:
    f.write(index_html)
with open(os.path.join(root, "style.css"), "w", encoding="utf-8") as f:
    f.write(style_css)
with open(os.path.join(root, "script.js"), "w", encoding="utf-8") as f:
    f.write(script_js)

# Copy the user's glasses image if present
user_img = "/mnt/data/47E35696-2370-4072-A30A-E18EA6123D89.png"
target_img = os.path.join(root, "glasses.png")
if os.path.exists(user_img):
    shutil.copy(user_img, target_img)
else:
    # create a placeholder if missing
    with open(target_img, "wb") as f:
        f.write(b"")

# Zip it for download
zip_path = "/mnt/data/vision-glasses-fileapp.zip"
with zipfile.ZipFile(zip_path, "w") as z:
    for fname in os.listdir(root):
        z.write(os.path.join(root, fname), arcname=fname)

zip_path